## Cascaded Shadow Maps


当定向光照影响到最大阴影距离范围内的所有物体时，它们的阴影贴图最终会覆盖一个大区域。由于阴影贴图使用正交投影，每个阴影贴图中的像素都有固定的世界空间尺寸。如果这个尺寸过大，单独的阴影像素会变得明显可见，导致阴影边缘呈锯齿状，小的阴影可能会消失。增加纹理集尺寸可以减轻这个问题，但只能在一定程度上解决。

使用透视相机时，远处的物体会显得较小。在某个可视距离上，一个阴影贴图像素会映射到一个单独的显示像素，这意味着阴影分辨率在理论上是最优的。靠近相机时，我们需要更高的阴影分辨率，而远离相机时，较低的分辨率就足够了。这暗示着理想情况下，我们应该根据阴影接收者的视距使用可变的阴影贴图分辨率。

级联阴影贴图是解决这个问题的一种方法。其核心思想是多次渲染阴影投射者，使得每个光源在纹理集中获得多个瓦片，即级联。第一个级联只覆盖靠近相机的小区域，随后的级联逐渐缩小，以相同数量的像素覆盖越来越大的区域。着色器会为每个片段采样最合适的级联。

### Settings


Unity的阴影代码支持每个定向光最多四个级联。目前，我们只使用了一个单一的级联，覆盖了一切直到最大阴影距离。为了支持更多级联，我们将在定向阴影设置中添加一个级联数量滑块。虽然我们可以在每个定向光中使用不同的级联数量，但在所有投射阴影的定向光中使用相同数量最合理。

每个级联覆盖了一部分投射阴影的区域，直到最大阴影距离。我们将通过为前三个级联添加比例滑块来使确切的部分可配置。最后一个级联始终覆盖整个范围，因此不需要滑块。默认情况下将级联数量设置为四，级联比例为0.1、0.25和0.5。这些比例应该每级联递增，但我们不会在用户界面中强制执行这一点。